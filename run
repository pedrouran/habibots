#!/bin/bash
# Launches all Habitat bots.

set -eo pipefail

trap 'kill %1; kill %2' SIGINT

HABITAT_HOST="${HABIBOTS_HOST-app.neohabitat.org}"
HABITAT_PORT="${HABIBOTS_PORT-1337}"
CONVERSATIONALIST_REGION="${HABIBOTS_CONVERSATIONALIST_REGION-context-welcomecenterinthatch}"
GREETER1_REGION="${HABIBOTS_GREETER1_REGION-context-welcomecenterinthatch}"

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

if [[ "${@}" = *"greeter1"* ]]; then
  echo 'Launching greeter1...'
  supervisor -w "${DIR}" -- greeter.js \
    -g "${DIR}/assets/greeting.txt" \
    -s "${HABIBOTS_SLACK_TOKEN}" \
    -c "${GREETER1_REGION}" \
    -h "${HABITAT_HOST}" \
    -p "${HABITAT_PORT}" \
    -l "newavatars" \
    -u phil &
fi

if [[ "${@}" = *"conversationalist"* ]]; then
  echo 'Launching conversationalist...'
  supervisor -w "${DIR}" -- conversationalist.js \
    -w "${HABIBOTS_WIT_TOKEN}" \
    -c "${CONVERSATIONALIST_REGION}" \
    -h "${HABITAT_HOST}" \
    -p "${HABITAT_PORT}" \
    -u tonybanks
fi

if [[ "${@}" = *"walker"* ]]; then
  echo 'Launching walker...'
  supervisor --inspect -w "${DIR}" -- walker.js \
    -g "${DIR}/assets/greeting.txt" \
    -c "${GREETER1_REGION}" \
    -h "${HABITAT_HOST}" \
    -p "${HABITAT_PORT}" \
    -u tonybanks
fi
